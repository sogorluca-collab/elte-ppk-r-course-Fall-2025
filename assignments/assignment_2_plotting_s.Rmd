---
title: 'Assignment 2: Data visualization'
author: "Tamas Nagy"
output: html_document
editor_options: 
  chunk_output_type: console
---

You will have to create 3 plots based on the datasets and instructions detailed below. You will find the plots themeselves in the `assignments/assignment_2_plots`. Your task is to write the code that will reproduce the plots as closely as possible.

# Skills needed to solve this assignment

-   Using R and RStudio, reading data
-   Reporting using RMarkdown
-   Using Git and Github (for submitting the task)
-   Data manipulation (e.g. dplyr, tidyr), and working with factors (forcats)
-   Data visuzlization (ggplot2)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(tidytuesdayR)
library(forcats)
library(viridis)
library(scales)
library(RColorBrewer)

```

## Task 1: Climbing expeditions

The following plot shows the number of expeditions in the 15 most popular peaks around the world. 

```{r task 1, echo = FALSE, warning = FALSE}
# Load the expeditions dataset
expeditions <- readr::read_csv(
  "https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-22/expeditions.csv", show_col_types = FALSE
)

# Count expeditions by peak and season
exp_counts <- expeditions %>%
  mutate(
    peak_name = fct_lump(peak_name, n = 15)  
  ) %>%
  filter(peak_name != "Other") %>%           
  count(peak_name, season, name = "n_exp")   

# Reorder the peaks by total expeditions
exp_counts <- exp_counts %>%
  group_by(peak_name) %>%
  mutate(total_exp = sum(n_exp)) %>%
  ungroup() %>%
  mutate(peak_name = fct_reorder(peak_name, total_exp))

# Plot
ggplot(exp_counts, aes(x = n_exp, y = peak_name, fill = season)) +
  geom_col() +
  scale_fill_viridis(discrete = TRUE) +
  theme_light() +
  labs(
    title = "The 15 most popular peaks stacked by season of expedition",
    x = "Number of expeditions",
    y = NULL,
    fill = "season"
  )

```

## Task 2: PhDs awarded

The following plot shows the number of awarded Ph.D-s in different education fields in the US by year.

```{r task 2, echo = FALSE, warning = FALSE}

phd <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-02-19/phd_by_field.csv", show_col_types = FALSE)

phd_sum <- phd %>%
  group_by(year, broad_field) %>%
  summarise(total_phds = sum(n_phds, na.rm = TRUE), .groups = "drop")

ggplot(phd_sum, aes(x = year, y = total_phds, color = broad_field)) +
  geom_line(size = 1.2) +
  scale_color_brewer(palette = "Dark2") +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(labels = comma_format()) +
  theme_minimal() +
  labs(
    title = "Number of awarded Ph.D.-s in the US by year",
    x = NULL,
    y = NULL,
    color = "Broad field"
  )


```

## Task 3: Commute in the US

The following plot shows the method of commuting to work in each state in the US. 

```{r task 3, echo = FALSE, warning = FALSE}

commute <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-11-05/commute.csv", show_col_types = FALSE)

commute_clean <- commute %>%
  mutate(
    state = case_when(
      state %in% state.name ~ state.abb[match(state, state.name)],
      TRUE ~ state
    ),
    state = toupper(state)
  )

commute_state <- commute_clean %>%
  filter(mode %in% c("Bike", "Walk")) %>%
  group_by(state, mode) %>%
  summarise(total = sum(n, na.rm = TRUE), .groups = "drop") %>%
  pivot_wider(names_from = mode, values_from = total)

region_lookup <- tibble(
  state = state.abb,
  region = state.region
)

commute_state <- left_join(commute_state, region_lookup, by = "state") %>%
  mutate(region = factor(region, levels = c("North Central", "Northeast", "South", "West", "Midwest"))) 

label_states <- c(
  "CA", "IL", "NY", "FL", "WA", "AZ", "MN",
"MI", "OH", "NJ", "MA","LA", "UT", "ID", "MT", "WY", "ND",
"ME", "VT", "NH", "DE", "KS", "NE", "IA", "IN", "CT", "RI", "OR", "AK"
)

labels_df <- commute_state %>%
  filter(state %in% label_states)

ggplot(commute_state, aes(x = Walk, y = Bike, color = region)) +
  geom_point(size = 2) +
  geom_text(
    data = labels_df,
    aes(label = state),
    color = "black",
    size = 3,
  ) +
  scale_x_log10(labels = comma_format()) +
  scale_y_log10(labels = comma_format()) +
  theme_light() +
  labs(
    title = "Number of people walking vs. biking to work in each USA state",
    x = "Number of ppl walking to work (log N)",
    y = "Number of ppl biking to work (log N)",
    color = "State region"
  )

```
